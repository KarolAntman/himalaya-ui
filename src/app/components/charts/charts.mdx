import { Layout, Playground, Attributes } from 'lib/components';
import { Chart, Link, Text, Code, Button, ToggleList, Spacer, useTheme, GraphDataView } from 'components';
import NextLink from 'next/link';
import { useRef, useEffect, createRef, useState } from 'react';

export const meta = {
  title: 'Charts',
  group: 'Charts',
};

# Charts

Charts creates interactive financial charts.

<Playground
  title="Line chart example"
  desc="A line chart exmaple"
  scope={{ Chart, useTheme }}
  code={`
    () => {
      return (
        <Chart>
          <Chart.Line title="Test Line" data={[
            { value: 1, time: 1642425322 },
            { value: 8, time: 1642511722 },
            { value: 10, time: 1642598122 },
            { value: 20, time: 1642684522 },
            { value: 10, time: 1642770922 },
            { value: 43, time: 1642857322 },
            { value: 41, time: 1642943722 },
            { value: 43, time: 1643030122 },
            { value: 56, time: 1643116522 },
            { value: 46, time: 1643202922 },
          ]} />
        </Chart>
      )
    }
  `}
/>

<Playground
  title="Area chart example"
  desc="A area chart example"
  scope={{ Chart, useTheme }}
  code={`
    () => {
      return (
        <>
          <Chart>
            <Chart.Area title="Test Area" data={[
              { value: 1, time: 1642425322 },
              { value: 8, time: 1642511722 },
              { value: 10, time: 1642598122 },
              { value: 20, time: 1642684522 },
              { value: 10, time: 1642770922 },
              { value: 43, time: 1642857322 },
              { value: 41, time: 1642943722 },
              { value: 43, time: 1643030122 },
              { value: 56, time: 1643116522 },
              { value: 46, time: 1643202922 },
            ]} />
          </Chart>
        </>
      )
    }
  `}
/>

<Playground
  title="Bar chart example"
  desc="A bar chart example"
  scope={{ Chart, useTheme }}
  code={`
    () => {
      return (
        <Chart>
          <Chart.Bar title="Test Area" data={[
            { value: 1, time: 1642425322 },
            { value: 8, time: 1642511722 },
            { value: 10, time: 1642598122 },
            { value: 20, time: 1642684522 },
            { value: 10, time: 1642770922 },
            { value: 43, time: 1642857322 },
            { value: 41, time: 1642943722 },
            { value: 43, time: 1643030122 },
            { value: 56, time: 1643116522 },
            { value: 46, time: 1643202922 },
          ]} />
        </Chart>
      )
    }
  `}
/>

<Playground
  title="Candlestick Chart"
  desc="A candlestick chart shows price movements in the form of candlesticks. On the candlestick chart, open & close values form a solid body of a candle while wicks show high & low values for a candlestick's time intervas"
  scope={{ Chart, useTheme }}
  code={`
    () => {
      return (
        <Chart showPopover={false}>
            <Chart.Candle  title="Test Area" data={[
                { time: 1642425322, open: 75.16, high: 82.84, low: 36.16, value: 45.72 },
                { time: 1642511722, open: 45.12, high: 53.90, low: 45.12, value: 48.09 },
                { time: 1642598122, open: 60.71, high: 60.71, low: 53.39, value: 59.29 },
                { time: 1642770922, open: 68.26, high: 68.26, low: 59.04, value: 60.50 },
                { time: 1642857322, open: 67.71, high: 105.85, low: 66.67, value: 91.04 },
          ]} />
        </Chart>
      )
    }
`}
/>

<Playground
  title="Multi-Line chart example"
  desc="A multi line chart example with different colors and legends"
  scope={{ Chart, useTheme }}
  code={`() => {
      const theme = useTheme();
      return (
          <Chart>
            <Chart.Line color={theme.palette.primary.value} title="Test Line" data={[
              { value: 1, time: 1642425322 },
              { value: 8, time: 1642511722 },
              { value: 10, time: 1642598122 },
              { value: 20, time: 1642684522 },
              { value: 10, time: 1642770922 },
              { value: 43, time: 1642857322 },
              { value: 41, time: 1642943722 },
              { value: 43, time: 1643030122 },
              { value: 56, time: 1643116522 },
              { value: 46, time: 1643202922 },
            ]} />
            <Chart.Line color={theme.palette.error.value} title="Test Line 2" data={[
              { value: 4, time: 1642425322 },
              { value: 17, time: 1642511722 },
              { value: 17, time: 1642598122 },
              { value: 15, time: 1642684522 },
              { value: 43, time: 1642770922 },
              { value: 28, time: 1642857322 },
              { value: 61, time: 1642943722 },
              { value: 43, time: 1643030122 },
              { value: 39, time: 1643116522 },
              { value: 12, time: 1643202922 },
            ]} />
            <Chart.Legends/>
          </Chart>
      )
}
`}
/>

<Playground
  title="Title or Data change example"
  desc="A multi line chart example with different colors and legends"
  scope={{ Chart, useTheme, Button, useState, ToggleList }}
  code={`() => {
      const min = 1;
      const max = 100;
      const theme = useTheme();
      const [enabled, setEnabled] = useState<boolean>(false);
      const generateData = () => {
        return [{ value: Math.random() * (max - min) + min, time: 1642425322 },
          { value: Math.random() * (max - min) + min, time: 1642511722 },
          { value: Math.random() * (max - min) + min, time: 1642598122 },
          { value: Math.random() * (max - min) + min, time: 1642684522 },
          { value: Math.random() * (max - min) + min, time: 1642770922 },
          { value: Math.random() * (max - min) + min, time: 1642857322 },
          { value: Math.random() * (max - min) + min, time: 1642943722 },
          { value: Math.random() * (max - min) + min, time: 1643030122 },
          { value: Math.random() * (max - min) + min, time: 1643116522 },
          { value: Math.random() * (max - min) + min, time: 1643202922 }];
      };
      const [data, setData] = useState<any>(generateData());
      const [data2, setData2] = useState<any>(generateData());
      const [dataViewMode, setDataViewMode] = useState<string>('graph');
      const [title, setTitle] = useState<any>('Serie 1');
      const hideHandler = () => setEnabled(!enabled);
      const changeDataHandler = () => {
        setData(generateData());
        setData2(generateData());
      };
      const changeTitle = () => {
        setTitle('New Serie ' +  Math.random());
      };
      return (
          <>
            <Button auto scale={0.5} onClick={hideHandler} type="warning">{enabled ? 'Hide Serie 2': 'Show Serie 2'}</Button>
            <Button auto scale={0.5} onClick={changeDataHandler} type="warning">Change Data</Button>
            <Button auto scale={0.5} onClick={changeTitle} type="warning">Change Title</Button>
            <ToggleList value={dataViewMode} onChange={val => setDataViewMode(val == 'graph' ? 'graph' : 'data')}>
              <ToggleList.Item value="graph">Graph</ToggleList.Item>
              <ToggleList.Item value="data">Data</ToggleList.Item>
            </ToggleList>
            <Chart viewMode={dataViewMode}>
              <Chart.Line color={theme.palette.primary.value} title={title} data={data} />
              {enabled && <Chart.Line color={theme.palette.error.value} title="Serie 2" data={data2} />}
              <Chart.Legends/>
              <Chart.DataView/>
            </Chart>
          </>
      )
}
`}
/>

<Playground
  title="Update example"
  desc="A time based update example"
  scope={{ Chart, useTheme, useRef, useEffect, createRef }}
  code={`() => {
        const chartRef = React.createRef();
        const data = [
              { value: 1, time: 1642425322 },
              { value: 8, time: 1642511722 },
              { value: 10, time: 1642598122 },
              { value: 20, time: 1642684522 },
              { value: 10, time: 1642770922 },
              { value: 43, time: 1642857322 },
              { value: 41, time: 1642943722 },
              { value: 43, time: 1643030122 },
              { value: 56, time: 1643116522 },
              { value: 46, time: 1643202922 },
        ];
        React.useEffect(() => {
          const last = data[data.length -1];
          const interval = setInterval(() => {
            const min = last.value - 5;
            const max = last.value + 5;
            last.value = Math.random() * (max - min) + min;
            last.time = last.time + (60 *  60 );
            if(chartRef && chartRef.current)
            {
                chartRef.current.update(last);
            }
          }, 1500);
          return () => clearInterval(interval);
        }, [chartRef]);
        return (
          <Chart>
            <Chart.Line ref={chartRef} title="Test Line" data={data} />
          </Chart>
      )
}
`}
/>

<Attributes edit="/app/components/charts.mdx">
<Attributes.Title>Chart.Props</Attributes.Title>

  | Attribute           | Description         | Type                       | Accepted values | Default  |
  | ------------------- | ------------------- | -------------------------- | --------------- | -------- |
  | **height**          | chart height        | `number`                   | -               | -        |
  | **showTime**        | show time           | `boolean`                  | -               | `false`  |
  | **showBottomHover** | show bottom hover   | `boolean`                  | -               | `false`  |
  | **showPopover**     | show popover        | `boolean`                  | -               | `false`  |
  | **showSeconds**     | show seconds        | `boolean`                  | -               | `false`  |
  | **timeFormatter**   | format time         | `TimeFormatterFn`          | -               | -        |
  | **tickFormatter**   | format tick         | `TickMarkFormatter`        | -               | -        |
  | **hasSides**        | chart sides         | `'right' | 'left' | 'both'` | -               | -        |
  | **viewMode**        | chart view mode     | `ChartViewMode`            | -               | -        |

<Attributes.Title>ChartSeriesProps</Attributes.Title>

```ts
type ChartSeriesProps = {
  data: ChartItem[];
  type: 'line' | 'area' | 'bar' | 'candle';
  side?: 'left' | 'right';
  showTitle?: boolean;
  visible?: boolean;
  color: string;
  priceLineVisible?: boolean;
  lastValueVisible?: boolean;
  priceFormatter?: ChartPriceFormatter;
};
```


</Attributes>
