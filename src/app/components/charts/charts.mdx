import { Layout, Playground, Attributes } from 'lib/components';
import { ThemedChart, Link, Text, Code, Button, Spacer, useTheme, GraphDataView } from 'components';
import NextLink from 'next/link';
import { useRef, useEffect, createRef, useState } from 'react';

export const meta = {
  title: 'Charts',
  group: 'Charts',
};

# Charts

Charts creates interactive financial charts.

<Playground
  title="Line chart example"
  desc="A line chart exmaple"
  scope={{ ThemedChart, useTheme }}
  code={`
    () => {
      return (
        <ThemedChart>
          <ThemedChart.Line title="Test Line" data={[
            { value: 1, time: 1642425322 },
            { value: 8, time: 1642511722 },
            { value: 10, time: 1642598122 },
            { value: 20, time: 1642684522 },
            { value: 10, time: 1642770922 },
            { value: 43, time: 1642857322 },
            { value: 41, time: 1642943722 },
            { value: 43, time: 1643030122 },
            { value: 56, time: 1643116522 },
            { value: 46, time: 1643202922 },
          ]} />
        </ThemedChart>
      )
    }
  `}
/>

<Playground
  title="Area chart example"
  desc="A area chart example"
  scope={{ ThemedChart, useTheme }}
  code={`
    () => {
      return (
        <>
          <ThemedChart>
            <ThemedChart.Area title="Test Area" data={[
              { value: 1, time: 1642425322 },
              { value: 8, time: 1642511722 },
              { value: 10, time: 1642598122 },
              { value: 20, time: 1642684522 },
              { value: 10, time: 1642770922 },
              { value: 43, time: 1642857322 },
              { value: 41, time: 1642943722 },
              { value: 43, time: 1643030122 },
              { value: 56, time: 1643116522 },
              { value: 46, time: 1643202922 },
            ]} />
          </ThemedChart>
        </>
      )
    }
  `}
/>

<Playground
  title="Bar chart example"
  desc="A bar chart example"
  scope={{ ThemedChart, useTheme }}
  code={`
    () => {
      return (
        <ThemedChart>
          <ThemedChart.Bar title="Test Area" data={[
            { value: 1, time: 1642425322 },
            { value: 8, time: 1642511722 },
            { value: 10, time: 1642598122 },
            { value: 20, time: 1642684522 },
            { value: 10, time: 1642770922 },
            { value: 43, time: 1642857322 },
            { value: 41, time: 1642943722 },
            { value: 43, time: 1643030122 },
            { value: 56, time: 1643116522 },
            { value: 46, time: 1643202922 },
          ]} />
        </ThemedChart>
      )
    }
  `}
/>

<Playground
  title="Candlestick Chart"
  desc="A candlestick chart shows price movements in the form of candlesticks. On the candlestick chart, open & close values form a solid body of a candle while wicks show high & low values for a candlestick's time intervas"
  scope={{ ThemedChart, useTheme }}
  code={`
    () => {
      return (
        <ThemedChart showPopover={false}>
            <ThemedChart.Candle  title="Test Area" data={[
                { time: 1642425322, open: 75.16, high: 82.84, low: 36.16, value: 45.72 },
                { time: 1642511722, open: 45.12, high: 53.90, low: 45.12, value: 48.09 },
                { time: 1642598122, open: 60.71, high: 60.71, low: 53.39, value: 59.29 },
                { time: 1642770922, open: 68.26, high: 68.26, low: 59.04, value: 60.50 },
                { time: 1642857322, open: 67.71, high: 105.85, low: 66.67, value: 91.04 },
          ]} />
        </ThemedChart>
      )
    }
`}
/>

<Playground
  title="Multi-Line chart example"
  desc="A multi line chart example with different colors and legends"
  scope={{ ThemedChart, useTheme }}
  code={`() => {
      const theme = useTheme();
      return (
          <ThemedChart>
            <ThemedChart.Line color={theme.palette.primary.value} title="Test Line" data={[
              { value: 1, time: 1642425322 },
              { value: 8, time: 1642511722 },
              { value: 10, time: 1642598122 },
              { value: 20, time: 1642684522 },
              { value: 10, time: 1642770922 },
              { value: 43, time: 1642857322 },
              { value: 41, time: 1642943722 },
              { value: 43, time: 1643030122 },
              { value: 56, time: 1643116522 },
              { value: 46, time: 1643202922 },
            ]} />
            <ThemedChart.Line color={theme.palette.error.value} title="Test Line 2" data={[
              { value: 4, time: 1642425322 },
              { value: 17, time: 1642511722 },
              { value: 17, time: 1642598122 },
              { value: 15, time: 1642684522 },
              { value: 43, time: 1642770922 },
              { value: 28, time: 1642857322 },
              { value: 61, time: 1642943722 },
              { value: 43, time: 1643030122 },
              { value: 39, time: 1643116522 },
              { value: 12, time: 1643202922 },
            ]} />
            <ThemedChart.Legends/>
          </ThemedChart>
      )
}
`}
/>

<Playground
  title="Title or Data change example"
  desc="A multi line chart example with different colors and legends"
  scope={{ ThemedChart, useTheme, Button, useState }}
  code={`() => {
      const min = 1;
      const max = 100;
      const theme = useTheme();
      const [enabled, setEnabled] = useState<boolean>(false);
      const generateData = () => {
        return [{ value: Math.random() * (max - min) + min, time: 1642425322 },
          { value: Math.random() * (max - min) + min, time: 1642511722 },
          { value: Math.random() * (max - min) + min, time: 1642598122 },
          { value: Math.random() * (max - min) + min, time: 1642684522 },
          { value: Math.random() * (max - min) + min, time: 1642770922 },
          { value: Math.random() * (max - min) + min, time: 1642857322 },
          { value: Math.random() * (max - min) + min, time: 1642943722 },
          { value: Math.random() * (max - min) + min, time: 1643030122 },
          { value: Math.random() * (max - min) + min, time: 1643116522 },
          { value: Math.random() * (max - min) + min, time: 1643202922 }];
      };
      const [data, setData] = useState<any>(generateData());
      const [data2, setData2] = useState<any>(generateData());
      const [title, setTitle] = useState<any>('Serie 1');
      const hideHandler = () => setEnabled(!enabled);
      const changeDataHandler = () => {
        setData(generateData());
        setData2(generateData());
      };
      const changeTitle = () => {
        setTitle('New Serie ' +  Math.random());
      };
      return (
          <>
            <Button auto scale={0.5} onClick={hideHandler} type="warning">{enabled ? 'Hide Serie 2': 'Show Serie 2'}</Button>
            <Button auto scale={0.5} onClick={changeDataHandler} type="warning">Change Data</Button>
            <Button auto scale={0.5} onClick={changeTitle} type="warning">Change Title</Button>
            <ThemedChart>
              <ThemedChart.Line color={theme.palette.primary.value} title={title} data={data} />
              {enabled && <ThemedChart.Line color={theme.palette.error.value} title="Serie 2" data={data2} />}
              <ThemedChart.Legends/>
            </ThemedChart>
          </>
      )
}
`}
/>

<Playground
  title="Update example"
  desc="A time based update example"
  scope={{ ThemedChart, useTheme, useRef, useEffect, createRef }}
  code={`() => {
        const chartRef = React.createRef();
        const data = [
              { value: 1, time: 1642425322 },
              { value: 8, time: 1642511722 },
              { value: 10, time: 1642598122 },
              { value: 20, time: 1642684522 },
              { value: 10, time: 1642770922 },
              { value: 43, time: 1642857322 },
              { value: 41, time: 1642943722 },
              { value: 43, time: 1643030122 },
              { value: 56, time: 1643116522 },
              { value: 46, time: 1643202922 },
        ];
        React.useEffect(() => {
          const last = data[data.length -1];
          const interval = setInterval(() => {
            const min = last.value - 5;
            const max = last.value + 5;
            last.value = Math.random() * (max - min) + min;
            last.time = last.time + (60 *  60 );
            if(chartRef && chartRef.current)
            {
                chartRef.current.update(last);
            }
          }, 1500);
          return () => clearInterval(interval);
        }, [chartRef]);
        return (
          <ThemedChart>
            <ThemedChart.Line ref={chartRef} title="Test Line" data={data} />
          </ThemedChart>
      )
}
`}
/>

<Attributes edit="/pages/components/charts.mdx">
<Attributes.Title>ThemedChart.Props</Attributes.Title>

| Attribute         | Description  | Type                | Accepted values | Default |
| ----------------- | ------------ | ------------------- | --------------- | ------- |
| **series**        | chart data   | `ThemedChartData`   | -               | -       |
| **showLegends**   | show lagend  | `boolean`           | -               | `false` |
| **showTime**      | show time    | `boolean`           | -               | `false` |
| **showSeconds**   | show seconds | `boolean`           | -               | `false` |
| **timeFormatter** | format time  | `TimeFormatterFn`   | -               | -       |
| **tickFormatter** | format tick  | `TickMarkFormatter` | -               | -       |

<Attributes.Title>ThemedChartData</Attributes.Title>

```ts
type ThemedChartData = {
  data: ThemedChartItem[];
  type: 'line' | 'area' | 'bar' | 'candle';
  side?: 'left' | 'right';
  showTitle?: boolean;
  visible?: boolean;
  color: string;
  priceLineVisible?: boolean;
  lastValueVisible?: boolean;
  priceFormatter?: ThemedChartPriceFormatter;
};
```

<Attributes.Title>UIThemes</Attributes.Title>

```ts
type UIThemes = {
  type: string;
  font: UIThemesFont;
  palette: UIThemesPalette;
  breakpoints: UIThemesBreakpoints;
  expressiveness: UIThemesExpressiveness;
};
```

</Attributes>
